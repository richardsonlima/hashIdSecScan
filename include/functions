#!/bin/sh

# Include
source include/constants

##############################################
# Name            :
# Description     :
# Returns         :
##############################################
CheckUmask(){

  if [ $? -eq 0 ]; then
       echo "Usually servers can have a more strict umask like (027), where desktops may be less strict (022)."
       echo -e "${OK} [+] Setting umask: ${NORMAL}"; umask $UMASK_OPTION && echo $UMASK_OPTION
     else
       echo -e "${WARNING} [x] Could not set umask ${NORMAL}"
  fi
}

##############################################
# Name            :
# Description     :
# Returns         :
##############################################
MyUser(){
  IM=`whoami`
  if [ "${IM}" = "root" ]; then
      echo -e "${WARNING} [x] This programm should not be executed as root ${NORMAL}"
      exit 0
  else
      echo -e "${OK} [+] User: ${NORMAL}" ${IM}
    fi
}

##############################################
# Name            :
# Description     :
# Returns         :
##############################################
BuildDir(){
  BUILDDIR="/opt/hashId-SecScan"
  if [ ! -d ${BUILDDIR} ]; then
      echo -e "${WARNING} [x] Directory not found: ${NORMAL}" ${BUILDDIR}
      echo -e "${WARNING} Hint:  Missing directory ... ${NORMAL}"
      echo -e "${OK} [+] Creating directory in: ${NORMAL}" ${BUILDDIR} ;sudo mkdir -p ${BUILDDIR}
    else
      echo -e "${NOTICE} [+] BuildDir found: ${NORMAL}" ${BUILDDIR}
  fi
}


##############################################
# Name            :
# Description     :
# Returns         :
##############################################
NeedsDir(){
NEEDSDIR="include db logs"
for DIR in ${BUILDDIR}/${NEEDSDIR}; do
  #if [ -d "$DIR" -a ! -h "$DIR" ]; then
  if [ ! -d ${DIR} ]; then
    echo -e "${WARNING} [x] Directory not found: ${NORMAL}" ${DIR}
    echo -e "${WARNING} [x] Hint:  Missing directory ... ${NORMAL}"
    echo -e "${OK} [+] Creating directory in: ${NORMAL}" ${DIR} ; sudo mkdir -p ${DIR}
else
    echo -e "${NOTICE} [+] Directory found: ${NORMAL}" ${DIR}
fi
done
}

##############################################
# Name            :
# Description     :
# Returns         :
##############################################
CheckIncludeFiles(){
INCLUDE_DIR="${BUILDDIR}/include"
if sudo find -- "${INCLUDE_DIR}" -prune -type d -empty | grep -q .; then
  echo -e "${WARNING} [+] Now ${INCLUDE_DIR} is an empty directory ${NORMAL}"; CreateIncludeFiles
else
  echo -e "${OK} [+] Files found in include directory: ${NORMAL}" ${INCLUDE_DIR}
  echo -e "${NOTICE} [+] Now ${INCLUDE_DIR} is not empty, or is not a directory" \
                    "or is not readable or searchable in which case" \
                    "you should have seen an error message from find above. ${NORMAL}"
fi
}

##############################################
# Name            :
# Description     :
# Returns         :
##############################################
CreateIncludeFiles(){
           echo -e "${WARNING} [x] Include files wasn't found in include directory ... ${NORMAL}"
           echo -e "${OK} [+] Creating files in: ${NORMAL}" ${INCLUDE_DIR}; sudo cp -Rfa include/{constants,functions} ${INCLUDE_DIR}
           echo -e "${NOTICE} [+] Creating alias in user environment ... ${NORMAL}";sudo echo "alias hashidsecscan='/opt/hashId-SecScan/hashidsecscan' " >> ~/.bash_alias
           echo -e "${NOTICE} [+] Enabling alias in user environment ... ${NORMAL}";source ~/.bash_alias

}
